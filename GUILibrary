local Lib = {}

local player = game.Players.LocalPlayer
local Uis = game:GetService("UserInputService")
local TS = game:GetService("TweenService")
local Mouse = player:GetMouse()
local MarketplaceService = game:GetService("MarketplaceService")
local Minimized, MinimizeUsable, visible, Usable = false, true, true, true
if _G.HideKeybind == nil then _G.HideKeybind = Enum.KeyCode.P end

local function generateRandomName()
    return "ScriptGui_" .. tostring(tick())
end

local randomName = generateRandomName()

if game.CoreGui:FindFirstChild(randomName) then
    game.CoreGui[randomName]:Destroy()
end

local ScriptGui = Instance.new("ScreenGui")
ScriptGui.Name = randomName
ScriptGui.ResetOnSpawn = false
ScriptGui.Parent = game.CoreGui

Uis.InputBegan:Connect(function(input, gameProcesses)
    if gameProcesses or input.KeyCode ~= _G.HideKeybind or not Usable then return end
    Usable = false
    visible = not visible
    for _, v in pairs(ScriptGui:GetDescendants()) do
        if v:IsA("GuiObject") then
            v.Visible = visible
        end
    end
    Usable = true
end)

local function CreateTween(object, properties, duration, repeatCount)
    local tweenInfo = TweenInfo.new(duration, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut, repeatCount or -1, true)
    local tween = TS:Create(object, tweenInfo, properties)
    tween:Play()
    return tween
end

function Lib:Window()
    local Window = {}
    local Sections = {}
    local ActiveButton = nil
    local ActiveLine = nil

    local Main = Instance.new("Frame", ScriptGui)
    local MainStroke = Instance.new("UIStroke", Main)
    local TitleFrame = Instance.new("Frame", Main)
    local Line = Instance.new("Frame", TitleFrame)
    local LineGradient = Instance.new("UIGradient", Line)
    local SectionHolder = Instance.new("ScrollingFrame", Main)
    local ContentFrame = Instance.new("Frame", Main)
    local SectionHolderLayout = Instance.new("UIListLayout", SectionHolder)

    Main.Size = UDim2.new(0,900,0,600)
    Main.Position = UDim2.new(0.5,-450,0.5,-300)
    Main.Active = true
    Main.BackgroundColor3 = Color3.fromRGB(45,45,45)

    MainStroke.Color = Color3.fromRGB(110,110,110)
    MainStroke.Thickness = 3

    TitleFrame.Position = UDim2.new(0,0,0,0)
    TitleFrame.Size = UDim2.new(1,0,0.15,0)
    TitleFrame.Active = true
    TitleFrame.BackgroundTransparency = 1

    Line.Size = UDim2.new(0.9998,0,0,3)
    Line.Position = UDim2.new(0,0,0,0)
    Line.BackgroundColor3 = Color3.fromRGB(70, 70, 70)

    LineGradient.Rotation = 0
    LineGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),
        ColorSequenceKeypoint.new(0.16, Color3.fromRGB(255, 165, 0)),
        ColorSequenceKeypoint.new(0.33, Color3.fromRGB(255, 255, 0)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 0)),
        ColorSequenceKeypoint.new(0.66, Color3.fromRGB(0, 0, 255)),
        ColorSequenceKeypoint.new(0.83, Color3.fromRGB(75, 0, 130)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(148, 0, 211))
    }
    CreateTween(LineGradient, { Rotation = 360 }, 4)

    SectionHolder.Size = UDim2.new(0.15,0,0.85,0)
    SectionHolder.Position = UDim2.new(0.025,0,0.15,0)
    SectionHolder.ScrollBarThickness = 0
    SectionHolder.BackgroundTransparency = 1

    SectionHolderLayout.Padding = UDim.new(0, 5)

    ContentFrame.Size = UDim2.new(0.8, 0, 0.85, 0)
    ContentFrame.Position = UDim2.new(0.2, 0, 0.15, 0)
    ContentFrame.BackgroundTransparency = 1

    local function MakeDraggable(frame, handle)
        local dragging, dragStart, startPos

        handle.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                dragStart = input.Position
                startPos = frame.Position
            end
        end)

        handle.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
            end
        end)

        Uis.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                local delta = input.Position - dragStart
                frame.Position = UDim2.new(
                    startPos.X.Scale, startPos.X.Offset + delta.X,
                    startPos.Y.Scale, startPos.Y.Offset + delta.Y
                )
            end
        end)
    end
    MakeDraggable(Main, TitleFrame)

    function Window:Section(Name)
        Sections[Name] = Instance.new("Frame", ContentFrame)
        Sections[Name].Size = UDim2.new(1, 0, 1, 0)
        Sections[Name].BackgroundTransparency = 1

        local button = Instance.new("TextButton", SectionHolder)
        local line = Instance.new("Frame", button)

        button.Size = UDim2.new(1, 0, 0, 50)
        button.BackgroundTransparency = 0.2
        button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        button.Text = Name
        button.TextSize = 20
        button.TextColor3 = Color3.fromRGB(180, 180, 180)
        button.Font = Enum.Font.SourceSansBold
        button.TextXAlignment = Enum.TextXAlignment.Center

        line.Size = UDim2.new(0, 4, 1, 0)
        line.Position = UDim2.new(0, 0, 0, 0)
        line.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
        line.Visible = false

        button.MouseButton1Click:Connect(function()
            for _, v in pairs(ContentFrame:GetChildren()) do
                v.Visible = false
            end
            Sections[Name].Visible = true
            if ActiveLine then
                ActiveLine.Visible = false
                ActiveButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
                ActiveButton.TextColor3 = Color3.fromRGB(180, 180, 180)
            end
            line.Visible = true
            ActiveLine = line
            ActiveButton = button
            button.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
            button.TextColor3 = Color3.fromRGB(255, 255, 255)
        end)
    end
    
    return Window
end

return Lib
